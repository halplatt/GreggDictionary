<!DOCTYPE html>
<!-- 
	opens dictionary based on GSD parm or last button pressed, Defaults to the DJS dictionary 
This is the main HTML file for the Gregg Shorthand Dictionary Search application. 
It includes a search interface with various buttons that trigger different search functions. 

V2025.0831@5:37pm bring data.djs.js and data.ann.js into this main HTML file
v2025.0828@3:45pm use generated links from !shared-links.html
v2025.0819@1:56pm modify links where gst merged with in page
v2025.0805@10:54pm split ann arrays in to two external files  ann_dict and ann_dict_reverse
v2025.0706.0430pm split ann arrays in to two external files  ann_dict and ann_dict_reverse
v2025.0624.0112am for public domain only, savedbuttons limited to pre or ann 
V2025.0619.0245pm add show hide dictionaries button
-->
<html>
	<head>
		<title>Gregg Shorthand Dictionary Search</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=0.8">
		<script>
		// IIFE to set the global variable `public_domain_only` ;
		// if page name ends in 'pd' only public domain dictionaries are shown.
		(function () {
			// Prefer explicit query param ?public_domain_only=...
			var usp = new URLSearchParams(window.location.search || '');

			// Derive from the current file name if no param: ends with "pd"
			var fileName = (window.location.pathname.split('/').pop() || '').toLowerCase();
			var baseName = fileName.replace(/\.[^.]+$/, ''); // strip extension like .html/.htm
			var derived = baseName.endsWith('pd') ? 'pd' : '';

			// Expose globally for existing code to use
			window.public_domain_only = usp.get('public_domain_only') || derived;
		})();
		</script>

		</script>
		<!-- JavaScripts with cachebusting querystring-->
		<!-- Data arrays of words -->
		<script type="text/javascript" src="dataset.djs.js?v=2025.0528.0323pm"></script>
        <script type="text/javascript" src="dataset.ann.js?v=2025.0706.11:11am"></script>
		<script type="text/javascript" src="dataset.ann.reverse.js?v=2025.0706.11:11am"></script>
		<script type="text/javascript" src="djsWords/!words.array.js?v=2025.0507.11:11am"></script>
		<script>
       		document.addEventListener('DOMContentLoaded', function() {
    			document.getElementById('version').innerHTML = "v2025.0828@3:45pm";
				if (public_domain_only === 'pd') {
					document.getElementById('version').innerHTML += "<br><i>items in the public domain.</i>";
				}		
			});	
		</script>
		<style type="text/css">
			body {
				font-family: 'Roboto', 'Helvetica', 'Arial', 'Sans-Serif';
				margin: 0 0;
				background-color: #DDD;
				color: #333;
			}
			h1 {
				font-family: 'Roboto Condensed', sans-serif;
				font-size: 2.5em;
				font-weight: normal;
				text-align: center;
				color: #333;
			}

			h2 {
				font-family: 'Roboto Condensed', sans-serif;
				font-size: 1.5em;
				font-weight: normal;
				text-align: left;
				color: #333;
			}
			a {
				text-decoration: none;
				transition: color 0.3s;
				color: #507ec9;
			}
			a:hover {
				color: #2D5493;
			}
			p {
				font-size: 1.0em;
				line-height: 1.5em;
				color: #555;
				text-align: justify;
			}
			.version-tag {
				position: absolute;
				top: 10px;
				right: 10px;
				background-color: #f1f1f1;
				padding: 5px 10px;
				border-radius: 5px;
				font-size: 12px;
				color: #333;
			}
			.container ul li, .container ol li {
				font-size: 1.0em;
				line-height: 1.8em;
				color: #555;
			}
			.container ul li ul li, .container ol li ol li{
				font-size: 0.8em;
				line-height: 1.8em;
				color: #666;
			}
			.container {
				padding: 0% 5% 0% 5%;
				max-width: 50em;
				margin: 0 auto;
			}
			.input-container {
				display: flex;
				align-items: center;
				justify-content: center;
				margin-bottom: 10px;
			}
			.input-container button {
				color: black;
				background-color: #f0f0f0;
				border: 1px solid #ccc;
				padding: 5px 10px;
				cursor: pointer;
			}
			.input-container input {
				margin: 0 5px;
				padding: 5px;
				border: 1px solid #ccc;
				border-radius: 4px;
				width: 200px;
			}
			.search {
				min-height: 5em;
				margin: 0 auto;
				display: table;
			}

			.inner {
				display: inline-block;
				vertical-align: middle;
				margin: 0;
			}

			.middle {
				display: table-cell;
				vertical-align: middle;
			}
			/* Center the buttons */		
			button {
				border: none;
				color: white;
				text-align: center;
				text-decoration: none;
				display: inline-block;
				font-size: 16px;
				margin: 4px 2px;
				cursor: pointer;
				border-radius: 12px;
				padding: 8px 16px;
				transition-duration: 0.4s;
			}
			button:hover {
				background-color: #45a049;
			}
			button.djs {background-color: #507ec9;}
			button.ann {background-color: #009fc4;}
			button.pre {background-color: #0089c4;}
			button.cen {background-color: #017699;}
			button.sim {background-color: #1000f5b0;}
			button.s90 {background-color: #6b5fc7;}
			button.all {background-color: #00c42e;}
			/* the following class hides buttons and links */
			.ann, .pre, .sim, .djs, .cen, .s90 {
				display: none !important;
			}
			#txt1 {
				font-size: 1.5em;
				height: 1.2em;
				border-top-left-radius : 0.3em;
				border-bottom-left-radius : 0.3em;
				border: 1px solid #999;
				background-color: #EEE;
				padding: 0.1em 0.5em;
				margin: 0 0 0 0;
				border-right-style: none;
			}

			#txt1 :focus {
				border-color: #507ec9;
			}

			#btn1 {
				font-size: 1em;
				height: 2.2em;
				width: 2.2em;
				margin: 0 0 0 0;
				border: none;
				padding: 8px;
			}

			#btn1 img {
				width: 1.4em;
				height: 1.4em;
			}

			#record {
				display: flex;
				flex-direction: column;
				align-items: center;
			}

			#suggest input {
				font-size: 1.0em;
				background-color: #EEE;
				border: 1px solid #507ec9;
				border-radius: 0.3em;
				color: #507ec9;
				transition-duration: 0.3s;
				margin: 0.2em;
			}
			#suggest {
				display: block;
				width: 100%;
				margin: 1em auto 0 auto;
				text-align: center;
				clear: both;
			}
			#suggest h2 {
			text-align: center;
			margin-left: auto;
			margin-right: auto;
			}


			#suggest figure {
				display: inline-block;
				float: none !important;
				margin: 0 0.5em;
				vertical-align: top;
				text-align: center;
			}

			#suggest input:hover {
				background-color: #507ec9;
				color: #EEE;
			}
			#about {
							clear: both;
							display: block;
							margin-left: auto;
							margin-right: auto;
							text-align: center;
							max-width: 90%;
							padding-left: 0;
							padding-right: 0;
			}
			.relative {
            	position: relative;
			}
			.absolute {
				position: absolute;
			}
			.max-w-none {
				max-width: none;
			}
			.overflow-hidden {
				overflow: hidden;
			}
			.border {
				border: 1px solid black;
			}
		</style>
		<script type="text/javascript">
			if (public_domain_only === 'pd') {
				const style = document.createElement('style');
				style.innerHTML = `
				.sim,
				.djs,
				.cen,
				.all,
				.s90 {
					display: none !important;
				}`;
				document.head.appendChild(style);
			}
			function getQueryParams() {
				const params = {};
				const queryString = window.location.search.substring(1);
				const regex = /([^&=]+)=([^&]*)/g;
				let m;
				while (m = regex.exec(queryString)) {
					params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
				}
				return params;
			}
			
			
			let lastButton; // Define global variable to hold last button clicked

			function initializeLastButton() {
				const savedButton = localStorage.getItem('lastButton');
				if (savedButton) {
					if (public_domain_only === 'pd') {  // If pd, only allow only pre or ann
						if (savedButton === 'refreshPreWord') {
							lastButton = 'refreshPreWord'
						} else if (savedButton === 'refreshAnnPhrase') {
						
						} else {
							lastButton = 'refreshAnnWord'
						}
					} else {
						lastButton = savedButton; // Retrieve from localStorage
					}
				} else {
					if (public_domain_only === 'pd') {
						setLastButton('refreshAnnWord');
					} else {
						setLastButton('refreshDjsWord');
					}	
				}
			}
			function setLastButton(buttonName) {
				lastButton = buttonName;
				localStorage.setItem('lastButton', buttonName); // Save to localStorage
			}

			function getCurrentClass() { 
				if (lastButton) {
					initializeLastButton(); // Ensure lastButton is initialized
				} else {
					return null;
				}
				return lastButton.slice(7, 10).toLowerCase();
			}

			function handleGsdParam() {
				initializeLastButton(); // Ensure lastButton is initialized
				const params = getQueryParams();
				if (params.gsd) {
					switch (params.gsd) {
						case 'ann':
							setLastButton('refreshAnnWord');
							break;
						case 'pre':
							setLastButton('refreshPreWord');
							break;
						case 'sim':
							setLastButton('refreshSimWord');
							break;
						case 'djs':
							setLastButton('refreshDjsWord');
							break;
						case 's90':
							setLastButton('refreshS90Word');
							break;
						default:
							if (public_domain_only === 'pd') {
								setLastButton('refreshAnnWord');
							} else {
								setLastButton('refreshDjsWord');
							}	
							break;
						}
					}
					if (typeof window[lastButton] === 'function') {
						window[lastButton]();
					} else {
						refreshDjsWord();
					}
			}
			function hideSuggestion() {
				document.getElementById("suggest").style.display = "none";
				document.getElementById('txt1').select();
			}

			function initializePage() {
				initializeLastButton(); // Initialize lastButton from localStorage
				// Event to place focus and select text after focus or click
				window.addEventListener('focus', function() {
					document.getElementById('txt1').focus();
					document.getElementById('txt1').select();
				});

				document.addEventListener('click', function() {
					document.getElementById('txt1').focus();
					document.getElementById('txt1').select();
				});
				//handle parms
				const params = getQueryParams();
				let word;
				if (params.x) {
					word = params.x;
				} else { // use a random word if no word is provided
					const rndNbr = Math.floor(Math.random() * ann_dict.length);
					word = ann_dict[rndNbr];
				}
				document.getElementById("txt1").value=word;
				
				document.getElementById('txt1').select();
				handleGsdParam();				
			}
	
			window.onload = initializePage;
			
		function openOrFocusTab(url, target) {
            var newTab = window.open('', target);
            if (newTab.location.href === "about:blank") {
                newTab.location.href = url;
            } else {
                //do nothing, the tab is already open
            }
            newTab.focus();
        }

		</script>
	</head>
	<script>
			//begin show hide dictionaries -------
			
document.addEventListener('DOMContentLoaded', function() {
	const dictClasses = ['ann', 'pre', 'sim', 'djs', 'cen', 's90', 'all'];
  const btn = document.getElementById('toggleDictBtn');
  let showingAll = false;

	function setDisplayForClass(cls, visible) {
		document.querySelectorAll('.' + cls).forEach(el => {
			// Toggle the element itself
			el.style.setProperty('display', visible ? 'block' : 'none', 'important');
			// Also toggle its nearest wrapper to avoid empty shells
			const parentInner = el.closest('.inner');
			if (parentInner) {
				parentInner.style.setProperty('display', visible ? 'inline-block' : 'none', 'important');
			}
		});
	}

 function showPdDictOnly() {
		// Show only ann and pre items; hide others including 'all'
		dictClasses.forEach(cls => {
			setDisplayForClass(cls, ['ann', 'pre'].includes(cls));
		});
    btn.style.setProperty('display', 'none', 'important'); //no button when showing public domain dictionaries
    showingAll = false;
  }

  function showCurrentDict() {
		const currentDict = getCurrentClass(); // e.g., "ann"
		dictClasses.forEach(cls => {
			setDisplayForClass(cls, cls === currentDict);
		});
    btn.textContent = "show all dictionaries";
    showingAll = false;
  }

  function showAllDicts() {
		dictClasses.forEach(cls => setDisplayForClass(cls, true));
    btn.textContent = "show fewer dictionaries";
    showingAll = true;
  }

  btn.addEventListener('click', () => {
    if (showingAll) {
      showCurrentDict();
    } else {
      showAllDicts();
    }
  });

	const currentDict = getCurrentClass(); // e.g., "ann"
	if (public_domain_only === 'pd') {
		showPdDictOnly();
	} else
	if (currentDict) {
  		showCurrentDict();
	} else {
		showAllDicts();			
	}

	// If shared links or other content is injected later (e.g., data-include), reapply current view
	const shared = document.getElementById('shared-links');
	if (shared) {
		const mo = new MutationObserver(() => {
			if (public_domain_only === 'pd') {
				showPdDictOnly();
			} else if (showingAll) {
				showAllDicts();
			} else {
				showCurrentDict();
			}
		});
		mo.observe(shared, { childList: true, subtree: true });
	}
});

	//end show hide dictionaries  -------
//begin inline data.djs.js

let simReferencejson = [];

// Function to load JSON and assign to global variable
function loadsimReferencejson() {
    fetch('./simDictionary/!reference.json')
        .then(response => response.json())
        .then(data => {
            simReferencejson = data; // Now available globally
            // You can call other functions here if needed
        })
        .catch(error => {
            console.error('Error loading reference data:', error);
        });
}

// Run after DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    loadsimReferencejson();
});
function findPageByWord(searchValue) {
	const regex = new RegExp('^'+searchValue+'$', 'i');
    for (const page of simReferencejson) {
        for (const word of page.words) {
            if (regex.test(word.t)) {
                // Return the page object and the matching word object
                return {
                    page: page.page,
                    word: word.t,
                    x: word.x,
                    y: word.y
                };
            }
        }
    }
    return null; // Not found
}

function findIdx(input,arrName) {
    var i
    for (i = 0; i < arrName.length; i++) 
        {
            if (arrName[i].toLowerCase() > input.toLowerCase()) {break}
        }
    if (i>0){i--}
    return arrName[i]
}

function findNum(input,arrName) {
    var i
    for (i = 0; i < arrName.length; i++) 
        {
            if (arrName[i].toLowerCase() > input.toLowerCase()) {break}
        }
if (i==0){i++}
    return i
}
// Generic function to handle page forward or back adjustment
function pageCntAdj(cntAdj, arrayName) {
	if (typeof cntAdj !== 'undefined' && !isNaN(cntAdj)) {
        let word = getTrimmedTxt1();
        let num = findNum(word, arrayName);
        num = --num + cntAdj; // Adjust for page forward or back and commpensate for 0 based array
        if (num < 0) { num = 0; }
        if (num >= arrayName.length - 1) { num = arrayName.length - 1; }
        document.getElementById('txt1').value = arrayName[num];
    }
}
function buildWordImg(word) {
    const regexPattern = new RegExp(`^${word}$`, 'i'); // Match the full word exactly (case-insensitive)
    const verifiedWord=dict.find(entry => regexPattern.test(entry)); // Returns the first case-sensitive match
	if (verifiedWord === undefined) {//word not in the array
		return `<p style="text-align: center;">Outline for ${word} not in the DJS image collection.</p>`;
	} else {//word is in the array
		return `<img src="djsWords/${verifiedWord}.png" title="${verifiedWord}" alt="${verifiedWord}" onerror="this.outerHTML='<span>Outline for ${verifiedWord} not available</span>'"><br>`;
	}
}

// Helper function to get and trim txt1 value, then update the input field
function getTrimmedTxt1() {
	var word = document.getElementById('txt1').value.trim();
	document.getElementById('txt1').value = word;
	return word;
}

function refreshDjsWord(cntAdj) {
	setLastButton('refreshDjsWord')
	pageCntAdj(cntAdj, djsWord);
	hideSuggestion()
	loadAboutDJS()
	document.getElementById('gsdTitle').innerHTML = "Gregg Diamond Jubilee Shorthand";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,djsWord);
	var path = buildWordImg(word)
	path += '<img src="djsDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}

function refreshDjsName(cntAdj) {
	setLastButton('refreshDjsName')
	pageCntAdj(cntAdj, pageCntAdj(cntAdj, djsName));
	hideSuggestion()
	loadAboutDJS()
	document.getElementById('gsdTitle').innerHTML = "Gregg Diamond Jubilee Shorthand (Proper Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,djsName);
	var path = buildWordImg(word)
	path += '<img src="djsDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}

function refreshDjsPhrase(cntAdj) {
	setLastButton('refreshDjsPhrase');
	pageCntAdj(cntAdj, djsPhrase);
	hideSuggestion()
	loadAboutDJS()
	document.getElementById('gsdTitle').innerHTML = "Gregg Diamond Jubilee Shorthand (Phrases)";
	var word = getTrimmedTxt1();
	var wordNum = findNum(word,djsPhrase);
	var path = buildWordImg(word)
	path += '<img src="djsDictionary/';
	path = path.concat('djsPhrase ','(',wordNum,')', '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}



function refreshS90Word(cntAdj) {
	setLastButton('refreshS90Word');
	pageCntAdj(cntAdj, s90Word);
	hideSuggestion()
	loadAboutS90()
	document.getElementById('gsdTitle').innerHTML = "Gregg Series 90 Shorthand";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,s90Word);
	var path = '<img src="s90Dictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshS90Phrase(cntAdj) {
	setLastButton('refreshS90Phrase');
	pageCntAdj(cntAdj, s90Phrase);
	hideSuggestion() 
	loadAboutS90()
	document.getElementById('gsdTitle').innerHTML = "Gregg Series 90 Shorthand (Phrases)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,s90Phrase);
	var path = '<img src="s90Dictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
 
function refreshS90Women(cntAdj) {
	setLastButton('refreshS90Women');
	pageCntAdj(cntAdj, s90Women);
	hideSuggestion()
	loadAboutS90()
	document.getElementById('gsdTitle').innerHTML = "Gregg Series 90 Shorthand (Women Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,s90Women);
	var path = '<img src="s90Dictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshS90Men(cntAdj) {
	setLastButton('refreshS90Men');
	pageCntAdj(cntAdj, s90Men);
	hideSuggestion()
	loadAboutS90()
	document.getElementById('gsdTitle').innerHTML = "Gregg Series 90 Shorthand (Men Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,s90Men);
	var path = '<img src="s90Dictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshS90Sur(cntAdj) {
	setLastButton('refreshS90Sur');
	pageCntAdj(cntAdj, s90Sur);
	hideSuggestion()
	loadAboutS90()
	document.getElementById('gsdTitle').innerHTML = "Gregg Series 90 Shorthand (Sur Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,s90Sur);
	var path = '<img src="s90Dictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshS90USName(cntAdj) {
	setLastButton('refreshS90USName');
	pageCntAdj(cntAdj, s90USName);
	hideSuggestion()
	loadAboutS90()
	document.getElementById('gsdTitle').innerHTML = "Gregg Series 90 Shorthand (US City Names)";

	var word = getTrimmedTxt1();
	var wordId = findIdx(word,s90USName);
	var path = '<img src="s90Dictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshS90GeoName(cntAdj) {
	setLastButton('refreshS90GeoName');
	pageCntAdj(cntAdj, s90GeoName);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Series 90 Shorthand (Geographical Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,s90GeoName);
	var path = '<img src="s90Dictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshCenWord(cntAdj) {
	setLastButton('refreshCenWord');
	pageCntAdj(cntAdj, cenWord);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenWord);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshCenBrief(cntAdj) {
	setLastButton('refreshCenBrief');
	pageCntAdj(cntAdj, cenBrief);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand (Brief Forms)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenBrief);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}

function refreshCenPhrase(cntAdj) {
	setLastButton('refreshCenPhrase');
	pageCntAdj(cntAdj, cenPhrase);
	hideSuggestion() 
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand (Phrases)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenPhrase);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
 
function refreshCenWomen(cntAdj) {
	setLastButton('refreshCenWomen');
	pageCntAdj(cntAdj, cenWomen);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand (Women Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenWomen);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshCenMen(cntAdj) {
	setLastButton('refreshCenMen');
	pageCntAdj(cntAdj, cenMen);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand (Men Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenMen);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshCenSur(cntAdj) {
	setLastButton('refreshCenSur');
	pageCntAdj(cntAdj, cenSur);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand (Sur Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenSur);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshCenUSName(cntAdj) {
	setLastButton('refreshCenUSName');
	pageCntAdj(cntAdj, cenUSName);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand (US City Names)";

	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenUSName);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshCenGeoName(cntAdj) {
	setLastButton('refreshCenGeoName');
	pageCntAdj(cntAdj, cenGeoName);
	hideSuggestion()
	loadAboutCen()
	document.getElementById('gsdTitle').innerHTML = "Gregg Centennial Shorthand (Geographical Names)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,cenGeoName);
	var path = '<img src="cenDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshSimWord(cntAdj) {
	setLastButton('refreshSimWord');
	pageCntAdj(cntAdj, simWord);
	hideSuggestion()
	loadAboutSim()
	document.getElementById('gsdTitle').innerHTML = "Gregg Simplified Shorthand";
	var word = getTrimmedTxt1();
    // create a thumbnail image for the word
	document.getElementById('record').innerHTML = ""
	const result = findPageByWord(word);
	if (result) {
		const imageContainer = document.createElement('div');
		const DISPLAY_SIZE_SMALL = { x: 365, y: 100, offset: 5 };
        const DISPLAY_SIZE_LARGE = { x: 450, y: 180, offset: 10 };
        const IMG_WIDTH = 1281;
		imageContainer.className = 'relative overflow-hidden border';
		imageContainer.style.width = `${DISPLAY_SIZE_SMALL.x}px`;
		imageContainer.style.height = `${DISPLAY_SIZE_SMALL.y}px`;
		const img = document.createElement('img');
		img.className = 'absolute max-w-none';
		img.src = `./simDictionary/${result.page}.png`;
		img.alt = `Gregg shorthand for word: ${result.t}`;
		img.style.top = `-${result.y-25}px`; // Adjust to center the word vertically
		img.style.left = `-${result.x}px`; // Adjust to center the word horizontally
		img.style.width = '1281px'; // Assuming the image width is fixed
		imageContainer.appendChild(img);
		document.getElementById('record').appendChild(imageContainer);
	}


	var wordId = findIdx(word,simWord);
	var path = '<img src="simDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML += path;
}
function refreshSimName(cntAdj) {
	setLastButton('refreshSimName');
	pageCntAdj(cntAdj, simName);
	hideSuggestion()
	loadAboutSim()
	document.getElementById('gsdTitle').innerHTML = "Gregg Simplified Shorthand (Names)";
	var word = getTrimmedTxt1();

	// create a thumbnail image for the word
	document.getElementById('record').innerHTML = ""
	const result = findPageByWord(word);
	if (result) {
		const imageContainer = document.createElement('div');
		const DISPLAY_SIZE_SMALL = { x: 365, y: 100, offset: 5 };
        const DISPLAY_SIZE_LARGE = { x: 450, y: 180, offset: 10 };
        const IMG_WIDTH = 1281;
		imageContainer.className = 'relative overflow-hidden border';
		imageContainer.style.width = `${DISPLAY_SIZE_SMALL.x}px`;
		imageContainer.style.height = `${DISPLAY_SIZE_SMALL.y}px`;
		const img = document.createElement('img');
		img.className = 'absolute max-w-none';
		img.src = `./simDictionary/${result.page}.png`;
		img.alt = `Gregg shorthand for word: ${result.t}`;
		img.style.top = `-${result.y-25}px`; // Adjust to center the word vertically
		img.style.left = `-${result.x}px`; // Adjust to center the word horizontally
		img.style.width = '1281px'; // Assuming the image width is fixed
		imageContainer.appendChild(img);
		document.getElementById('record').appendChild(imageContainer);
	}



	var wordId = findIdx(word,simName);
	var path = '<img src="simDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML += path;
}
function refreshAnnPhrase(cntAdj) {
	setLastButton('refreshAnnPhrase');
	pageCntAdj(cntAdj, annPhrase);
	hideSuggestion() 
	loadAboutAnnPhrase()
	document.getElementById('gsdTitle').innerHTML = "Gregg Anniversary Shorthand (Phrases)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,annPhrase);
	var path = '<img src="annDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
function refreshPreWord(cntAdj) {
	setLastButton('refreshPreWord');
	pageCntAdj(cntAdj, preWord);
	hideSuggestion()
	loadAboutAnn()
	document.getElementById('gsdTitle').innerHTML = "Gregg Pre-Anniversary Shorthand (1916)";
	var word = getTrimmedTxt1();
	var wordId = findIdx(word,preWord);
	var path = '<img src="preWords/' + word + '.png" title="' + word + '" alt="' + word + '" onerror="this.outerHTML=\'<span>Outline not available</span>\'"><br>';
	path += '<img src="preDictionary/';
	path = path.concat(wordId, '.png" style="width:60%">');
	document.getElementById('record').innerHTML = path;
}
async function refreshAnnWord(cntAdj) {
	setLastButton('refreshAnnWord');
	hideSuggestion();
	loadAboutAnn();
	document.getElementById('gsdTitle').innerHTML = "Gregg Anniversary Shorthand";	// Adjust for page forward or back
	let word = getTrimmedTxt1().toLowerCase();
	let entryWord = findEntry(word,ann_dict); // Set the global variable entryWord to the current word
	let pageObj = await findPageObj(entryWord.toString()); // Use await here
	if (typeof cntAdj !== 'undefined' && !isNaN(cntAdj) && cntAdj !== 0 && pageObj !== null) { //If there is a count adjustment, adjust the word accordingly
		var pageNumber=parseInt(pageObj.page) + cntAdj;
		pageObj=await getPageByNumber(pageNumber)
		word=pageObj.words[0].t
		document.getElementById('txt1').value = word; // Update the input field with the new word
	}
	
	let order = findOrder(word);
	let order_reverse = findOrderReverse(word);
	let path;
	if (order >= 0) { //If word is found order is positive, display the word image
		path = '<img src="annWords/' + word + '.png">'
	} else {
		 path = "<p>Outline not available</p>";
	}
	//Add the page
	if (pageObj === null) {
		path += "<p>Dictionary Page not available</p>";
	} else {
		path += '<img src="annDictionary/';
		path = path.concat(pageObj.page.toString(), '.png" style="width:60%; display: block; margin: 10px auto;">');
	}



	if (order >= 0) { //If word is found order is positive
		//11/22/2020 Logic below adds suggestions
		var starting = order - 1;
		if (starting < 0) starting = 0;
		if (starting > ann_dict.length-4) starting = ann_dict.length-5; 
		for (let i = 0; i < 4; i++) {
			var thisWord = ann_dict[starting + i];
			document.getElementById('bt'.concat(i.toString())).value = thisWord;
			imgpath = '<img src="annWords/'+thisWord+'.png">';
			document.getElementById('sh'.concat(i.toString())).innerHTML  = imgpath;
		}
		starting = order_reverse - 1;
		if (starting < 0) starting = 0;
		if (starting > ann_dict_reverse.length-4) starting = ann_dict_reverse.length-5;
		for (let i = 0; i < 4; i++) {
			var thisWord = ann_dict_reverse[starting + i].split("").reverse().join("");
			document.getElementById('bt'.concat((i + 4).toString())).value = thisWord;
			imgpath = '<img src="annWords/'+thisWord+'.png">';
			document.getElementById('sh'.concat((i + 4).toString())).innerHTML = imgpath;
		}
		document.getElementById("suggest").style.display="inline-block";
	} else {
		path += "<p>Sorry, the word '" + word + "' is not found in the <i>Gregg Anniversary Shorthand Dictionary.</i></p>";
		var starting = -order-4;
		if (starting < 0) starting = 0;
		if (starting > ann_dict.length-4) starting = ann_dict.length-4;
		for (let i = 0; i < 4; i++) {
			var thisWord = ann_dict[starting + i];
			document.getElementById('bt'.concat(i.toString())).value = thisWord;
			imgpath = '<img src="annWords/'+thisWord+'.png">';
			document.getElementById('sh'.concat(i.toString())).innerHTML  = imgpath;
		}
		starting = -order_reverse - 3;
		if (starting < 0) starting = 0;
		if (starting > ann_dict_reverse.length-4) starting = ann_dict_reverse.length-4;
		for (let i = 0; i < 4; i++) {
			var thisWord = ann_dict_reverse[starting + i].split("").reverse().join("");
			document.getElementById('bt'.concat((i + 4).toString())).value = thisWord;
			imgpath = '<img src="annWords/'+thisWord+'.png">';
			document.getElementById('sh'.concat((i + 4).toString())).innerHTML = imgpath;
		}
		document.getElementById("suggest").style.display="block";		
	}
	document.getElementById('record').innerHTML = path;
}


function loadAboutDJS() {
	var aboutText = "";
	aboutText = aboutText.concat("<b>Page from</b> <i>Gregg Shorthand Dictionary DJS,</i> a book published by The McGraw-Hill Publishing Company in 1963, written by Charles Rader.");
	document.getElementById('about').innerHTML = aboutText;
}
function loadAboutS90() {
	var aboutText = "";
	aboutText = aboutText.concat("<b>Page from</b> <i>Gregg Shorthand Dictionary Series 90,</i> a book published by The McGraw-Hill Publishing Company in 1978, written by Charles Rader.");
	document.getElementById('about').innerHTML = aboutText;
}
function loadAboutCen() {
	var aboutText = "";
	aboutText = aboutText.concat("<b>Page from</b> <i>Gregg Shorthand Dictionary Centennial Edition Abridged,</i> a book published by The McGraw-Hill Publishing Company in 1989, written by Charles E. Zoubek, Gregg Condon.");
	document.getElementById('about').innerHTML = aboutText;
}
function loadAboutSim() {
	var aboutText = "";
	aboutText = aboutText.concat("<b>Page from</b> <i>Gregg Shorthand Dictionary Simplified,</i> a book published by The Gregg Publishing Company in 1945, written by Charles Rader. ");
	document.getElementById('about').innerHTML = aboutText;
}
function loadAboutAnnPhrase() {
	var aboutText = "";
	aboutText = aboutText.concat("<b>Page from</b> <i>Gregg Shorthand Phrase Book (1930),</i> a book published by The Gregg Publishing Company in 1930, forms written by Harriet M. Johnson.");
	if (public_domain_only == '') {
		aboutText = aboutText.concat(" A <a href=\"./annDictionary/AnnPhrasebook.pdf\" target=\"_blank\">pdf version here</a>.");
	}
	document.getElementById('about').innerHTML = aboutText;
}
function loadAboutPre() {
	var aboutText = "";
	aboutText = aboutText.concat("<i><b>Page from</b> Gregg Shorthand Dictionary (1916),</i> a book published by The Gregg Publishing Company in 1916, including 17,000 shorthand forms written by Alice Rinne Hagar.");
	if (public_domain_only == '') {
		aboutText = aboutText.concat(" A <a href=\"https://greggshorthand.github.io/gsd.pdf\" target=\"_blank\">pdf version</a> dictionary can be found on <a href=\"https://greggshorthand.github.io\" target=\"_blank\">this site</a>.");
	}
	document.getElementById('about').innerHTML = aboutText;
}
function loadAboutAnn() {
	var aboutText = "";
	aboutText = aboutText.concat("<i><b>image extracted from</b> Gregg Shorthand Dictionary,</i> a book published by The Gregg Publishing Company in 1930, including 18667 shorthand forms written by Winifred Kenna Richmond.");
	if (public_domain_only=='') {
		aboutText = aboutText.concat(" A <a href=\"https://greggshorthand.github.io/gsd.pdf\" target=\"_blank\">pdf version</a> dictionary can be found on <a href=\"https://greggshorthand.github.io\" target=\"_blank\">this site</a>.");
	}
	document.getElementById('about').innerHTML = aboutText;
}
//end inline data.djs.js

//beg inline data.ann.js
function findOrder(input) {
	var left = 0;
	var right = ann_dict.length - 1; // Dynamically set the right boundary
	var center;
	var comp;
	let compLeft, compRight;
	input = input.toLowerCase();
	while (right - left > 1) {
		center = Math.ceil((left + right) / 2);
		comp = input.localeCompare(ann_dict[center].toLowerCase());
		if (comp == 0) return center;
		if (comp < 0) right = center;
		if (comp > 0) left = center;
	}
	compLeft = input.localeCompare(ann_dict[left].toLowerCase());
	compRight = input.localeCompare(ann_dict[right].toLowerCase());
	if (compLeft == 0) return left;
	if (compRight == 0) return right;
	if (compLeft < 0) return -left - 1;
	if (compLeft > 0 && compRight < 0) return -left - 2;
	if (compRight > 0) return -left - 3;
}

function findOrderReverse(input) {
	var left = 0;
	var right = ann_dict_reverse.length - 1; // Dynamically set the right boundary
	var center;
	var comp;
	let compLeft, compRight;
	var input_reverse = input.toLowerCase().split("").reverse().join("");
	while (right - left > 1) {
		center = Math.ceil((left + right) / 2);
		comp = input_reverse.localeCompare(ann_dict_reverse[center].toLowerCase());
		if (comp == 0) return center;
		if (comp < 0) right = center;
		if (comp > 0) left = center;
	}
	compLeft = input_reverse.localeCompare(ann_dict_reverse[left].toLowerCase());
	compRight = input_reverse.localeCompare(ann_dict_reverse[right].toLowerCase());
	if (compLeft == 0) return left;
	if (compRight == 0) return right;
	// If not found, return the greatest value not greater than input_reverse
	if (compLeft < 0) return left > 0 ? left - 1 : -1; // input_reverse < left element
	if (compRight < 0) return left; // input_reverse is between left and right
	return right; // input_reverse > right element, return right as greatest not greater
}

function findEntry(word, dict) { //returns the last entry in dict that is not greater than word
	var left = 0;
	var right = dict.length - 1;
	var result = -1;
	word = word.toLowerCase();
	
	while (left <= right) {
		var center = Math.floor((left + right) / 2);
		var comp = dict[center].toLowerCase().localeCompare(word);
		
		if (comp <= 0) { // dict[center] <= word
			result = center;
			left = center + 1; // Look for a later occurrence
		} else { // dict[center] > word
			right = center - 1;
		}
	}
	
	return result >= 0 ? dict[result] : (dict.length > 0 ? dict[0] : null);
}

async function fetchData() {
	const response = await fetch('annDictionary/!reference.json');
	const annMap = await response.json();
	return annMap;
}

async function findPageObj(testWord) {
	const data = await fetchData();
	for (const page of data) {
		for (const word of page.words) {
			if (testWord.toLowerCase() === word.t.toLowerCase()) {
				return page;
			}
		}
	}
	return null; // Return null if no match is found
}

async function getPageByNumber(pageNumber) { //returns the page object for a given page number
	const data = await fetchData();
	if (pageNumber >= data.length) { // If pageNumber is greater than the last page, return the last page
		return data[data.length - 1];
	}
	if (pageNumber <= 1) { //if pageNumber is less than or equal to 1 Return the first page 
		return data[0]; 
	}
	pageNumber = pageNumber.toString().padStart(3, '0');
	return data.find(page => page.page === pageNumber) || null;
}



//end inline data.ann.js
	</script>
	<body>
		<div class="container">
				<div id="version" class="version-tag">not set</div>
				<h3 id="gsdTitle" style="text-align: center;">Gregg Shorthand Dictionary Search</h3>
				<button id="toggleDictBtn" style="position: absolute; top: 8px; left: 8px; z-index: 1000; background: #222; color: #fff; border: none; padding: 8px 16px; border-radius: 4px;">
					display all dictionary's
				</button>
				<div class="search">
					<div class="middle">
							<div class="input-container">
								<button onclick="window[lastButton](-1);" style="color: black; background-color: #f0f0f0;">&lt;</button>
								<input id="txt1" type="text" value="" onkeydown="if(event.keyCode==13){handleGsdParam()}" autofocus />
								<button onclick="window[lastButton](1);" style="color: black; background-color: #f0f0f0;">&gt;</button>
							</div>
                            <div class="inner">
                                <button id="btn1" class="djs" onclick="refreshDjsWord()" accesskey="d" title="(DJS) Alt+Shift+d">djs</button>
							</div>
                            <div class="inner">
                                <button id="btn2" onclick="refreshDjsName()" class="djs">djsName</button>
							</div>
			                 <div class="inner">
                                <button id="btn14" onclick="refreshDjsPhrase()"  accesskey="p" title="Alt+Shift+p" class="djs">djs<b>P</b>hrase</button>
							</div>
							<div class="inner">
                                <button id="btn3" onclick="refreshSimWord()" accesskey="s" class="sim" title="Alt+Shift+s"><b>S</b>implified</button>
							</div>
							<div class="inner">
                                <button id="btn4" class="sim" onclick="refreshSimName()">SimName</button>
							</div>
							<div class="inner">
                                <button id="btn15" class="s90" onclick="refreshS90Word()" accesskey="9" title="Alt+9">S<b>9</b>0</button>
							</div>
							<div class="inner">
                                <button id="btn16" class="s90" onclick="refreshS90Phrase()">S90Phrase</button>
							</div>
							<div class="inner">
                                <button id="btn17" class="s90" onclick="refreshS90Men()">S90Men</button>
							</div>
							<div class="inner">
                                <button id="btn18" class="s90" onclick="refreshS90Women()">S90Women</button>
							</div>
							<div class="inner">
                                <button id="btn19" class="s90" onclick="refreshS90Sur()">S90Sur</button>
							</div>
							<div class="inner">
                                <button id="btn20" class="s90" onclick="refreshS90USName()">S90USCity</button>
							</div>
							<div class="inner">
                                <button id="btn21" class="s90" onclick="refreshS90GeoName()">S90Geo</button>
							</div>
							<div class="inner">
                                <button id="btn5" class="cen" onclick="refreshCenWord()" accesskey="c" title="Alt+c"><b>C</b>entennial</button>
							</div>
							<div class="inner">
                                <button id="btn6" class="cen" onclick="refreshCenBrief()">CenBrief</button>
							</div>
							<div class="inner">
                                <button id="btn7" class="cen" onclick="refreshCenPhrase()">CenPhrase</button>
							</div>
							<div class="inner">
                                <button id="btn8" class="cen" onclick="refreshCenMen()">CenMenNm</button>
							</div>
							<div class="inner">
                                <button id="btn9" class="cen" onclick="refreshCenWomen()">CenWomenNm</button>
							</div>
							<div class="inner">
                                <button id="btn10" class="cen" onclick="refreshCenSur()">CenSurNm</button>
							</div>
							<div class="inner">
                                <button id="btn11" class="cen" onclick="refreshCenUSName()">CenUSCity</button>
							</div>
							<div class="inner">
                                <button id="btn12" class="cen" onclick="refreshCenGeoName()">CenGeo</button>
							</div>
							<!-- bug alt-shift-a does not work, so use alt-a -->
							<div class="inner">
                                <button id="btn13" class="ann" onclick="refreshAnnWord()" accesskey="a" title="Alt+a"><b>A</b>nniversary</button>
                            </div>
							<div class="inner">
                                <button id="btn22" class="ann" onclick="refreshAnnPhrase()">AnnPhrase</button>
							</div>
							<div class="inner">
                                <button id="btn14" class="pre" onclick="refreshPreWord()" accesskey="p" title="Alt+p"><b>P</b>re-anniversary</button>
                            </div>

<!-- beg place holder where common links begin if page is in same directory as !shared-links.html -->
<div id="shared-links"></div>
<script>
(function loadSharedLinks() {
	const hostEl = document.getElementById('shared-links');
	if (!hostEl) return;

	fetch('./!shared-links.html', { cache: 'no-cache' })
		.then(r => (r.ok ? r.text() : Promise.reject(r)))
		.then(html => {
			// Replace all "~/" paths with "./" since this page is in the same directory
			hostEl.innerHTML = html.replace(/~\//g, './');
		})
		.catch(err => {
			console.error('Failed to load shared links:', err);
		});
})();
</script>
<!-- end place holder where common links -->

						</div>
					</div>
				</div>


<br/>
				<div id="record"></div>

		<!-- Suggestions (only used by Anniversary) Hide otherwise -->
				<div id="suggest" style="display:none">
					<h2>Suggestions</h2>
				<figure>
					<figcaption><input id="bt0" type="button" value="bt0" onclick="document.getElementById('txt1').value = document.getElementById('bt0').value;refreshAnnWord()" /></figcaption>
					<span id="sh0"></span>
				</figure>
					<figure><figcaption><input id="bt1" type="button" value="bt1" onclick="document.getElementById('txt1').value = document.getElementById('bt1').value;refreshAnnWord()" /></figcaption>
					<span id="sh1"></span>
				</figure>
					<figure><figcaption><input id="bt2" type="button" value="bt2" onclick="document.getElementById('txt1').value = document.getElementById('bt2').value;refreshAnnWord()" /></figcaption>
					<span id="sh2"></span>
				</figure>
					<figure><figcaption><input id="bt3" type="button" value="bt3" onclick="document.getElementById('txt1').value = document.getElementById('bt3').value;refreshAnnWord()" /></figcaption>
					<span id="sh3"></span>
				</figure>
					<figure><figcaption><input id="bt4" type="button" value="bt4" onclick="document.getElementById('txt1').value = document.getElementById('bt4').value;refreshAnnWord()" /></figcaption>
					<span id="sh4"></span>
				</figure>
					<figure><figcaption><input id="bt5" type="button" value="bt5" onclick="document.getElementById('txt1').value = document.getElementById('bt5').value;refreshAnnWord()" /></figcaption>
					<span id="sh5"></span>
				</figure>
					<figure><figcaption><input id="bt6" type="button" value="bt6" onclick="document.getElementById('txt1').value = document.getElementById('bt6').value;refreshAnnWord()" /></figcaption>
					<span id="sh6"></span>
				</figure>
				<figure>
					<figcaption><input id="bt7" type="button" value="bt7" onclick="document.getElementById('txt1').value = document.getElementById('bt7').value;refreshAnnWord()" /></figcaption>
					<span id="sh7"></span>
				</figure>
				</div>
		<!-- End Suggestions -->
				<div id="about"></div>

		
	</body>

</html>
