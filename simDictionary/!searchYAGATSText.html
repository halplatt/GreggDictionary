<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAGATS Search</title>
    <script>
    //version 2025/08/05@10:28pm Use consolodated GST Text file which also contains YAGATS    
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input[type="text"] {
            width: 300px;
            padding: 5px;
            margin-right: 10px;
        }
        button {
            padding: 5px 10px;
            margin-right: 10px;
        }
        
        /* Style for reference/help button */
        .reference-btn {
            background-color: #6c757d;
            color: white;
            border: 1px solid #5a6268;
            border-radius: 3px;
            font-size: 12px;
            padding: 4px 8px;
            margin-left: 15px;
            cursor: pointer;
        }
        
        .reference-btn:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }
        
        /* Tooltip/Popover styles for reference chart */
        .reference-tooltip {
            position: absolute;
            display: none;
            background-color: white;
            border: 2px solid #888;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 15px;
        }
        
        .reference-tooltip h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
        }
        
        .tooltip-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .tooltip-table th,
        .tooltip-table td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: left;
            vertical-align: top;
        }
        
        .tooltip-table th {
            background-color: #f4f4f4;
            font-weight: bold;
        }
        
        .tooltip-table .char-col {
            width: 30px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .reference-tooltip {
                max-width: 90vw;
                max-height: 70vh;
                left: 5% !important;
                right: 5% !important;
                font-size: 11px;
            }
            
            .tooltip-table {
                font-size: 10px;
            }
            
            .tooltip-table .char-col {
                width: 25px;
                font-size: 12px;
            }
            
            .tooltip-table th,
            .tooltip-table td {
                padding: 3px 4px;
            }
            
            /* Mobile-specific button styling */
            .reference-btn {
                font-size: 11px;
                padding: 6px 10px;
                margin-left: 10px;
            }
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        h1 {
            margin-bottom: 5px;
        }
        .subtitle {
            font-size: 12px;
            color: #666;
            margin-top: 0px;
            margin-bottom: 15px;
            font-style: italic;
        }
        .version {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 14px;
            color: #555;
        }
         /* these styles are dictionary window */
        .relative {
            position: relative;
        }
        .absolute {
            position: absolute;
        }
        .max-w-none {
            max-width: none;
        }
        .overflow-hidden {
            overflow: hidden;
        }
        .border {
            border: 1px solid black;
        }
        .max-w-screen {
            max-width: 100vw;
        }
        .overflow-x-auto {
            overflow-x: auto;
        }
        .expand-button {
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .license-info {
            margin-top: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            color: #555;
        }
        .license-info p {
            margin: 5px 0;
        }
                /* these styles are for button and input row */
    .input-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin-bottom: 5px; /* Add small gap after navigation links */
    }
    .button-row {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping to the next line if needed */
        justify-content: flex-start;
        width: 100%;
        margin-bottom: 0px; /* Removed gap entirely */
        line-height: 1.2; /* Reduce line height to compact rows */
    }
    .button-row label {
        margin-right: 20px;
        display: flex;
        align-items: center;
        font-weight: normal;
        cursor: pointer;
    }
    .button-row input[type="radio"] {
        margin-right: 5px;
    }
    .input-row {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        width: 100%;
    }
    .inner {
        margin-right: 10px; /* Add spacing between links */
        display: inline-block; /* Ensure links are displayed inline */
    }   
    
    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }
    
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        border-radius: 5px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
    }
    
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        line-height: 1;
    }
    
    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
    }
    
    .reference-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    
    .reference-table th,
    .reference-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
        vertical-align: top;
    }
    
    .reference-table th {
        background-color: #f4f4f4;
        font-weight: bold;
    }
    
    .reference-table .char-col {
        width: 60px;
        text-align: center;
        font-family: 'Courier New', monospace;
        font-size: 16px;
        font-weight: bold;
    }
    
    @media (max-width: 768px) {
        .modal-content {
            margin: 10px;
            width: calc(100% - 20px);
            max-height: 90vh;
        }
        
        .reference-table {
            font-size: 14px;
        }
        
        .reference-table .char-col {
            width: 50px;
            font-size: 14px;
        }
    }
    </style>
</head>
<body>
    <div class="version">Version 08/05/2025@10:21pm</div>
    <h1>GreggSimplified YAGATS Search</h1>
    <p class="subtitle">using YAGATS (Yet Another Gregg-ASCII Transliteration System)</p>
    <a href="!searchYAGATSText(help).html" target="_blank" style="float: right; margin-bottom: 10px;">Help</a>
       <div class="input-container">
        <div class="button-row">
            <span>Link to main dictionary:</span>
            <div class="inner">
                <a href="javascript:void(0);" onclick="openOrFocusTab('../GreggDictionary' + public_domain_only + '.html', 'GreggDictionary')">Gregg Dictionary</a>
            </div>
        </div>
        <div class="button-row">
            <span>Link to Regex search for:</span>
            <div class="inner all">
                <a class="all" href="javascript:void(0);" onclick="openOrFocusTab('../!wordsearchall.html', 'allWords')">all-versions</a>
            </div>
            <div class="inner djs">
                <a a class="djs" href="javascript:void(0);" onclick="openOrFocusTab('../djsWords/!wordsearch.html', 'djsWords')">djs</a>
            </div>
            <div class="inner sim">
                <a a class="sim" href="javascript:void(0);" onclick="openOrFocusTab('../simDictionary/!wordsearch.html', 'simWords')">Simplified-in-page</a>
            </div>
            <div class="inner ann">
                <a class="ann"  href="javascript:void(0);" onclick="openOrFocusTab('../annWords/!wordsearch' + public_domain_only + '.html', 'annWords');">Anniversary</a>
            </div>
            <div class="inner ann">
                <a class="ann" href="javascript:void(0);" onclick="openOrFocusTab('../annDictionary/!wordsearch' + public_domain_only + '.html', 'annWordsinpage');">Anniversary-in-page</a>
            </div>
            <div class="inner pre">
                <a class="pre" href="javascript:void(0);" onclick="openOrFocusTab('../preWords/!wordsearch' + public_domain_only + '.html', 'preWords');">pre-Anniversary</a>
            </div>
        </div>
        <div class="button-row">
            <span>Link to text to Gregg for:</span>
            <div class="inner">
                <a class="djs" href="javascript:void(0);" onclick="openOrFocusTab('../djsWords/!textToGregg.html', 't2djsWords');">djs</a>
            </div>
            <div class="inner">
                <a class="ann" href="javascript:void(0);" onclick="openOrFocusTab('../annWords/!textToGregg' + public_domain_only + '.html', 't2annWords');">Anniversary</a>
            </div>
            <div class="inner">
                <a class="pre" href="javascript:void(0);" onclick="openOrFocusTab('../preWords/!textToGregg' + public_domain_only + '.html', 't2preWords');">pre-Anniversary</a>
            </div>
        </div>
    </div>

    <div class="button-row" style="margin-top: 15px;">
        <label><input type="radio" name="searchType" value="beginsWith" checked> Begins with</label>
        <label><input type="radio" name="searchType" value="contains"> Contains</label>
        <label><input type="radio" name="searchType" value="endsWith"> Ends with</label>
        <label><input type="radio" name="searchType" value="exact"> Exact match</label>
    </div>
    <input type="text" id="regexInput" placeholder="Enter search text">
    <button id="searchGST" accesskey="y">YAGATS Search (Alt+Y)</button>
    <button id="searchText" accesskey="t">Text Search (Enter)</button>
    <button id="referenceBtn" class="reference-btn" accesskey="r">? Character Reference (Alt+R)</button>
    
    <!-- Tooltip for character reference -->
    <div id="referenceTooltip" class="reference-tooltip">
        <h3>YAGATS Special Characters</h3>
        <table class="tooltip-table">
            <thead>
                <tr>
                    <th class="char-col">Char</th>
                    <th>Meaning</th>
                </tr>
            </thead>
            <tbody>
                <tr><td class="char-col">(</td><td>the "over th" stroke</td></tr>
                <tr><td class="char-col">)</td><td>the "under th" stroke</td></tr>
                <tr><td class="char-col">$</td><td>the "sh" stroke</td></tr>
                <tr><td class="char-col">^</td><td>caret indicates a high floating prefix e.g. o^du = "overdue"</td></tr>
                <tr><td class="char-col">*</td><td>asterisk indicates an intersecting stroke; p*m = "p.m."</td></tr>
                <tr><td class="char-col">:</td><td>colon indicates a disjoined stroke, for example, bro(:d = "brotherhood"</td></tr>
                <tr><td class="char-col">%</td><td>percent sign indicates a special turning as in o% = "all"</td></tr>
                <tr><td class="char-col">~</td><td>tilde indicates the "jog" as seen between m and n in "I am not"</td></tr>
                <tr><td class="char-col">=</td><td>capitalization mark</td></tr>
                <tr><td class="char-col">5</td><td>(left s + comma s) blend as in a5 = access</td></tr>
                <tr><td class="char-col">3</td><td>(comma s + left s) blend</td></tr>
                <tr><td class="char-col">c</td><td>ch stroke</td></tr>
                <tr><td class="char-col">y</td><td>represents the -ally/-ily suffix loop</td></tr>
                <tr><td class="char-col">h</td><td>the "h" dot</td></tr>
                <tr><td class="char-col">q</td><td>the dot representing the suffix "-ing"</td></tr>
                <tr><td class="char-col">@</td><td>the dot representing the word "a" or "an"</td></tr>
                <tr><td class="char-col">A</td><td>the dot that replaces the first 'a' as in Ahed = "ahead" and Auak = "awake"</td></tr>
                <tr><td class="char-col">w</td><td>indicates that the next vowel has the "w dash" under it; kwek = "quick"</td></tr>
                <tr><td class="char-col">s</td><td>the "comma s" stroke</td></tr>
                <tr><td class="char-col">z</td><td>the "left s" stroke</td></tr>
            </tbody>
        </table>
    </div>
    <table id="resultsTable">
        <thead>
            <tr>
                <th>Text</th>
                <th>YAGATS</th>
                <th>Outline</th>
            </tr>
        </thead>
        <tbody>
            <!-- Results will be displayed here -->
        </tbody>
    </table>

    <!-- YAGATS Reference Modal -->
    <div id="referenceModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>YAGATS Special Characters Reference</h2>
            <table class="reference-table">
                <thead>
                    <tr>
                        <th class="char-col">Character</th>
                        <th>Meaning</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td class="char-col">(</td><td>the "over th" stroke</td></tr>
                    <tr><td class="char-col">)</td><td>the "under th" stroke</td></tr>
                    <tr><td class="char-col">$</td><td>the "sh" stroke</td></tr>
                    <tr><td class="char-col">^</td><td>caret indicates a high floating prefix e.g. o^du = "overdue"</td></tr>
                    <tr><td class="char-col">*</td><td>asterisk indicates an intersecting stroke; p*m = "p.m."</td></tr>
                    <tr><td class="char-col">:</td><td>colon indicates a disjoined stroke, for example, bro(:d = "brotherhood"</td></tr>
                    <tr><td class="char-col">%</td><td>percent sign indicates a special turning as in o% = "all"</td></tr>
                    <tr><td class="char-col">~</td><td>tilde indicates the "jog" as seen between m and n in "I am not"</td></tr>
                    <tr><td class="char-col">=</td><td>capitalization mark</td></tr>
                    <tr><td class="char-col">5</td><td>(left s + comma s) blend as in a5 = access</td></tr>
                    <tr><td class="char-col">3</td><td>(comma s + left s) blend</td></tr>
                    <tr><td class="char-col">c</td><td>ch stroke</td></tr>
                    <tr><td class="char-col">y</td><td>represents the -ally/-ily suffix loop</td></tr>
                    <tr><td class="char-col">h</td><td>the "h" dot</td></tr>
                    <tr><td class="char-col">q</td><td>the dot representing the suffix "-ing"</td></tr>
                    <tr><td class="char-col">@</td><td>the dot representing the word "a" or "an"</td></tr>
                    <tr><td class="char-col">A</td><td>the dot that replaces the first 'a' as in Ahed = "ahead" and Auak = "awake"</td></tr>
                    <tr><td class="char-col">w</td><td>indicates that the next vowel has the "w dash" under it; kwek = "quick"</td></tr>
                    <tr><td class="char-col">s</td><td>the "comma s" stroke</td></tr>
                    <tr><td class="char-col">z</td><td>the "left s" stroke</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="license-info">
        <p><strong>YAGATS Notation by:</strong> DailyGregg Consortium | <strong>License:</strong> Creative Commons NonCommercial 4.0 International License</p>
    </div>

    <script>
        // Variable for public domain only links (appears to be used in some links)
        var public_domain_only = ''; // Set to empty string or appropriate value
        
        // Function to open or focus a tab
        function openOrFocusTab(url, target) {
            var newTab = window.open('', target);
            if (newTab.location.href === "about:blank") {
                newTab.location.href = url;
            } else {
                //do nothing, the tab is already open
            }
            newTab.focus();
        } 
        

        
        // Load the JSON file
        let dataGST = [];
        fetch('!searchGSText.json')
            .then(response => response.json())
            .then(jsonData => {
                dataGST = jsonData;
            })
            .catch(error => console.error('Error loading JSON:', error));

     
        let dataRef = [];
        fetch('!reference.json')
            .then(response => response.json())
            .then(jsonData => {
                dataRef = jsonData;
            })
            .catch(error => console.error('Error loading JSON:', error));
        // determine if the page is in the ann or sim directory
        var globalGsd
        try {
                const url = new URL(window.location.href);
                const path = url.pathname;
                const folderName = path.substring(0,path.lastIndexOf('/')).split('/').pop();

                document.title = `YAGATS Search of ${folderName}`;
                document.querySelector('h1').textContent = `YAGATS Search of ${folderName}`;
                document.querySelector('title').textContent = `YAGATS Search of ${folderName}`;
                globalGsd = folderName.substring(0,3);
            } catch (error) {
                //document.title = `GST Search of ${imagePath1}`;
            }
  
        // Function to display results in the table
        function displayResults(results, searchTerm = '', searchType = '', searchCategory = '') {
            const tableBody = document.querySelector('#resultsTable tbody');
            tableBody.innerHTML = ''; // Clear previous results
            
            if (results.length === 0) {
                // Display no results message
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 3; // Span all three columns
                cell.style.textAlign = 'center';
                cell.style.fontStyle = 'italic';
                cell.style.color = '#666';
                cell.style.padding = '20px';
                
                // Format search type for display
                const searchTypeDisplay = {
                    'contains': 'contains',
                    'beginsWith': 'begins with',
                    'endsWith': 'ends with',
                    'exact': 'exact match'
                };
                
                cell.textContent = `No results found for ${searchCategory} ${searchTypeDisplay[searchType] || 'contains'} search: "${searchTerm}"`;
                row.appendChild(cell);
                tableBody.appendChild(row);
                return;
            }
            
            results.forEach(entry => {
                const row = document.createElement('tr');
                const textCell = document.createElement('td');
                const gstCell = document.createElement('td');
                const pageCell = document.createElement('td'); // New column for page.page

                textCell.textContent = entry.text || ''; // Handle missing text
                gstCell.textContent = entry.YAGATS || ''; // Handle missing gst

                // Call searchRefJson and get the page value
                // Call imageContainer and append the resulting div to pageCell
                const imageDiv = imageContainer(entry.text || '');
                pageCell.appendChild(imageDiv);

                row.appendChild(textCell);
                row.appendChild(gstCell);
                row.appendChild(pageCell); // Append the new column
                tableBody.appendChild(row);
            });
        }

        // Function to get the selected search type
        function getSearchType() {
            const radios = document.getElementsByName('searchType');
            for (const radio of radios) {
                if (radio.checked) {
                    return radio.value;
                }
            }
            return 'beginsWith'; // default fallback
        }

        // Function to perform search based on type
        function performSearch(searchInput, targetText, searchType, caseSensitive = false) {
            const input = caseSensitive ? searchInput : searchInput.toLowerCase();
            const target = caseSensitive ? targetText : targetText.toLowerCase();
            
            switch (searchType) {
                case 'beginsWith':
                    return target.startsWith(input);
                case 'endsWith':
                    return target.endsWith(input);
                case 'exact':
                    return target === input;
                case 'contains':
                default:
                    return target.includes(input);
            }
        }

        // Event listener for the "Search GST" button
        document.getElementById('searchGST').addEventListener('click', () => {
            const searchInput = document.getElementById('regexInput').value;
            const searchType = getSearchType();
            const results = dataGST.filter(entry => 
                entry.YAGATS && performSearch(searchInput, entry.YAGATS, searchType, true) // Case-sensitive for YAGATS
            );
            displayResults(results, searchInput, searchType, 'YAGATS');
            // Refocus and select text after search
            focusAndSelectText();
        });

        // Event listener for the "Search Text" button
        document.getElementById('searchText').addEventListener('click', () => {
            const searchInput = document.getElementById('regexInput').value;
            const searchType = getSearchType();
            const results = dataGST.filter(entry => 
                entry.text && performSearch(searchInput, entry.text, searchType, false) // Case-insensitive for Text
            );
            displayResults(results, searchInput, searchType, 'Text');
            // Refocus and select text after search
            focusAndSelectText();
        });

        // Function to focus on input and select all text
        function focusAndSelectText() {
            const input = document.getElementById('regexInput');
            input.focus();
            input.select();
        }

        // Set initial focus when page loads
        window.addEventListener('load', () => {
            focusAndSelectText();
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            if (event.altKey) {
                if (event.key.toLowerCase() === 'y') {
                    event.preventDefault();
                    document.getElementById('searchGST').click();
                }
            } else if (event.key === 'Enter') {
                event.preventDefault();
                document.getElementById('searchText').click();
            }
        });

        // Add event listeners to radio buttons to refocus text input
        document.addEventListener('DOMContentLoaded', () => {
            const radios = document.getElementsByName('searchType');
            radios.forEach(radio => {
                radio.addEventListener('click', () => {
                    focusAndSelectText();
                });
            });
        });

        // Tooltip functionality for reference chart
        const tooltip = document.getElementById('referenceTooltip');
        const referenceBtn = document.getElementById('referenceBtn');
        let tooltipVisible = false;

        // Function to position tooltip
        function positionTooltip() {
            const rect = referenceBtn.getBoundingClientRect();
            tooltip.style.display = 'block';
            
            // Force a reflow to get accurate dimensions
            tooltip.offsetHeight;
            
            const tooltipRect = tooltip.getBoundingClientRect();
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            // Calculate available space
            const spaceAbove = rect.top;
            const spaceBelow = windowHeight - rect.bottom;
            const spaceLeft = rect.left;
            const spaceRight = windowWidth - rect.right;
            
            // Default position: above the button
            let left = rect.left;
            let top = rect.top - tooltipRect.height - 10;
            
            // Mobile adjustments
            if (windowWidth <= 768) {
                left = (windowWidth - tooltipRect.width) / 2;
                top = Math.max(20, (windowHeight - tooltipRect.height) / 2);
                
                // Adjust max-height for mobile if content is taller than available space
                const maxMobileHeight = windowHeight - 40; // 20px margin top and bottom
                if (tooltipRect.height > maxMobileHeight) {
                    tooltip.style.maxHeight = maxMobileHeight + 'px';
                }
            } else {
                // Desktop: choose position with more space
                if (spaceAbove < tooltipRect.height + 20 && spaceBelow > spaceAbove) {
                    // Show below button if more space below
                    top = rect.bottom + 10;
                }
                
                // Calculate optimal height based on available space
                const availableHeight = Math.max(spaceAbove - 20, spaceBelow - 20);
                const contentHeight = tooltipRect.height;
                
                // If we have enough space, remove height restriction
                if (availableHeight >= contentHeight) {
                    tooltip.style.maxHeight = 'none';
                } else {
                    // Otherwise, use the available space
                    tooltip.style.maxHeight = Math.min(availableHeight, windowHeight * 0.8) + 'px';
                }
                
                // Adjust horizontal position
                if (left + tooltipRect.width > windowWidth) {
                    // Adjust left position if going off right edge
                    left = windowWidth - tooltipRect.width - 20;
                }
                if (left < 0) {
                    // Adjust left position if going off left edge
                    left = 10;
                }
                
                // Final vertical adjustment after height changes
                const newTooltipRect = tooltip.getBoundingClientRect();
                if (top < 10) {
                    top = 10;
                } else if (top + newTooltipRect.height > windowHeight - 10) {
                    top = windowHeight - newTooltipRect.height - 10;
                }
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }

        // Show tooltip on hover (desktop)
        referenceBtn.addEventListener('mouseenter', () => {
            if (window.innerWidth > 768) { // Only on desktop
                tooltipVisible = true;
                positionTooltip();
            }
        });

        // Hide tooltip when mouse leaves button (desktop)
        referenceBtn.addEventListener('mouseleave', () => {
            if (window.innerWidth > 768) { // Only on desktop
                setTimeout(() => {
                    if (!tooltip.matches(':hover') && !referenceBtn.matches(':hover')) {
                        tooltipVisible = false;
                        tooltip.style.display = 'none';
                    }
                }, 100);
            }
        });

        // Hide tooltip when mouse leaves tooltip (desktop)
        tooltip.addEventListener('mouseleave', () => {
            if (window.innerWidth > 768) { // Only on desktop
                setTimeout(() => {
                    if (!tooltip.matches(':hover') && !referenceBtn.matches(':hover')) {
                        tooltipVisible = false;
                        tooltip.style.display = 'none';
                    }
                }, 100);
            }
        });

        // Keep tooltip visible when hovering over it (desktop)
        tooltip.addEventListener('mouseenter', () => {
            if (window.innerWidth > 768) { // Only on desktop
                tooltipVisible = true;
                tooltip.style.display = 'block';
            }
        });

        // Click/touch support for mobile and desktop
        referenceBtn.addEventListener('click', (event) => {
            event.preventDefault();
            tooltipVisible = !tooltipVisible;
            
            if (tooltipVisible) {
                positionTooltip();
            } else {
                tooltip.style.display = 'none';
            }
        });

        // Hide tooltip when clicking outside
        document.addEventListener('click', (event) => {
            if (!tooltip.contains(event.target) && !referenceBtn.contains(event.target)) {
                tooltipVisible = false;
                tooltip.style.display = 'none';
            }
        });

        // Alt+R keyboard shortcut and Escape key
        document.addEventListener('keydown', (event) => {
            if (event.altKey && event.key.toLowerCase() === 'r') {
                event.preventDefault();
                tooltipVisible = !tooltipVisible;
                
                if (tooltipVisible) {
                    positionTooltip();
                } else {
                    tooltip.style.display = 'none';
                }
            } else if (event.key === 'Escape' && tooltipVisible) {
                tooltipVisible = false;
                tooltip.style.display = 'none';
            }
        });
        // Function to search for a specific text in the JSON data
        function searchRefJson(searchTerm) {
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            for (const page of dataRef) {
                for (const word of page.words) {
                    if (word.t.toLowerCase() === lowerCaseSearchTerm) {
                        return {
                            page: page.page,
                            word: word.t,
                            x: word.x,
                            y: word.y
                        };
                    }
                }
            }
            return null; // Return null if no match is found
        }
        function imageContainer(searchTerm) {
            const DISPLAY_SIZE_SMALL = { x: 365, y: 100, offset: 5 };
            const DISPLAY_SIZE_LARGE = { x: 450, y: 180, offset: 10 };
            const IMG_WIDTH = 1281;
            const objRef = searchRefJson(searchTerm);

            const resultItem = document.createElement('div');
                        resultItem.className = 'result-item';
             // If searchRefJson returns null, return an empty resultItem
            if (!objRef) {
                resultItem.innerHTML = 'No match found';
               
                resultItem.addEventListener('click', function() {
                    const url = `/GreggDictionary.html?x=${searchTerm}&gsd=${globalGsd}`;
                    window.open(url, 'GreggDictionary');
                });
                return resultItem;
            }
            resultItem.innerHTML = `Page: ${objRef.page}, Word: ${objRef.word}`; // , X: ${word.x}, Y: ${word.y}`;
            if (globalGsd === 'ann') {
                resultItem.addEventListener('click', function() {
                const url = `!searchpages.html?w=${objRef.page}`;
                window.open(url, `searchpages${globalGsd}`);
                });
            }

            const outerContainer = document.createElement('div');
            outerContainer.className = 'max-w-screen overflow-x-auto';

            const imageContainer = document.createElement('div');
            imageContainer.className = 'relative overflow-hidden border';
            imageContainer.style.width = `${DISPLAY_SIZE_SMALL.x}px`;
            imageContainer.style.height = `${DISPLAY_SIZE_SMALL.y}px`;

            const img = document.createElement('img');
            img.className = 'absolute max-w-none';
            if (window.location.hostname == "halplatt.github.io") { //names must be lower case on github (this only matters for the sim pages and ann pages are numeric)
                img.src = `${objRef.page.toLowerCase()}.png`;
            } else {
                img.src = `${objRef.page}.png`;
            }
            img.alt = `Gregg shorthand for word: ${objRef.word}`;
            img.style.top = `-${objRef.y - 50}px`; // Adjust to center the word vertically
            img.style.left = `-${objRef.x - 182.5}px`; // Adjust to center the word horizontally
            img.style.width = '1281px'; // Assuming the image width is fixed

            img.onload = function() {
                const scale = IMG_WIDTH / img.naturalWidth;
                img.style.top = `-${objRef.y * scale - DISPLAY_SIZE_SMALL.y / 2}px`;
                img.style.left = `-${objRef.x * scale - DISPLAY_SIZE_SMALL.offset}px`;
                img.style.width = `${IMG_WIDTH}px`;
            };

            img.onclick = function() {

                event.stopPropagation(); // Prevent the event from bubbling up to the resultItem
                /*const clipboardInput = document.getElementById("clipboardInput");
                clipboardInput.value = word.t;
                clipboardInput.select();
                document.execCommand("copy");
                clipboardInput.value = ""; */
                if (window.location.hostname == "halplatt.github.io") {
                    var url = `/GreggDictionary/GreggDictionary.html?x=${objRef.word}&gsd=${globalGsd}`;
                } else {
                    var url = `/GreggDictionary.html?x=${objRef.word}&gsd=${globalGsd}`;
                }
                window.open(url, 'GreggDictionary');
            };

            const expandButton = document.createElement('button');
            expandButton.className = 'expand-button';
            expandButton.innerHTML = 'Expand';
            expandButton.onclick = function() {
                event.stopPropagation(); // Prevent the event from bubbling up to the resultItem
                if (imageContainer.style.width === `${DISPLAY_SIZE_SMALL.x}px`) {
                    imageContainer.style.width = `${DISPLAY_SIZE_LARGE.x}px`;
                    imageContainer.style.height = `${DISPLAY_SIZE_LARGE.y}px`;
                    img.style.top = `-${objRef.y * (IMG_WIDTH / img.naturalWidth) - DISPLAY_SIZE_LARGE.y / 2}px`;
                    img.style.left = `-${objRef.x * (IMG_WIDTH / img.naturalWidth) - DISPLAY_SIZE_LARGE.offset}px`;
                    expandButton.innerHTML = 'Shrink';
                } else {
                    imageContainer.style.width = `${DISPLAY_SIZE_SMALL.x}px`;
                    imageContainer.style.height = `${DISPLAY_SIZE_SMALL.y}px`;
                    img.style.top = `-${objRef.y * (IMG_WIDTH / img.naturalWidth) - DISPLAY_SIZE_SMALL.y / 2}px`;
                    img.style.left = `-${objRef.x * (IMG_WIDTH / img.naturalWidth) - DISPLAY_SIZE_SMALL.offset}px`;
                    expandButton.innerHTML = 'Expand';
                }
            };

            imageContainer.appendChild(img);
            outerContainer.appendChild(imageContainer);
            outerContainer.appendChild(expandButton);
            resultItem.appendChild(outerContainer);
            return resultItem;

        }
        </script>
</body>
</html>